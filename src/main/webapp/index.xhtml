<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <h:outputStylesheet name="css/mycsslayout.css"/>
    <h:outputScript name="js/script.js" target="head"/>
    <title>Conversation</title>
</h:head>
<h:body style="background-color: #f5f5f5; padding: 20px;">
    <f:view>

        <!-- Les éventuels messages d'erreur non liés à un champ particulier sont affichés ici en rouge -->
        <h:messages errorStyle="color: red" showDetail="true" showSummary="false" globalOnly="true"/>

        <!-- Section d'upload de document (en dessous du rôle d'assistant, formulaire séparé) -->
        <h:form id="pdfform" enctype="multipart/form-data">
            <h:panelGroup style="padding: 10px;">
                <h:outputText value="Avez-vous d'autres thèmes que vous voulez en parler? Dites-les-nous.  " style="font-weight: 500; color: #333;"/>
                <h:inputFile id="file" value="#{bb.fichier}" style="display: none;" onchange="document.getElementById('pdfform:uploadBtn').click();"/>
                <h:commandButton id="uploadBtn" value="Upload Files PDF" action="#{bb.upload}" style="display: none;"/>
                <h:commandButton value="Upload Files PDF" onclick="document.getElementById('pdfform:file').click(); return false;" styleClass="upload-button"/>
                <h:outputText value="  "/>
                <h:outputText value="#{bb.messagePourChargementFichier}"
                              rendered="#{not empty bb.messagePourChargementFichier}" 
                              style="color: #388e3c; font-weight: 500; margin-left: 10px;"/>
            </h:panelGroup>
        </h:form>
        
        <h:form id="form2">
            
            <p:outputLabel for="rolesysteme" value="Rôle de l'assistant : "/>
            <!-- La valeur choisie dans cette liste déroulante sera affectée
            à la propriété systemRole du backing bean. Cette liste est figée (disabled)
            dès qu'une requête a été envoyée au serveur. -->
            <p:selectOneMenu id="rolesysteme" value="#{bb.roleSysteme}" editable="true"
                             required="false"
                             disabled="#{! bb.roleSystemeChangeable}">
                <f:selectItems value="#{bb.rolesSysteme}"/>
            </p:selectOneMenu>
            <!-- Message d'erreur ici si l'utilisateur oublie d'indiquer un rôle système. -->
            <h:message for="rolesysteme" errorStyle="color: red" />

            <!-- Si on veut commencer un nouveau chat avec, éventuellement, un autre rôle. -->
            <h:outputText value="  "/>
            <h:commandButton value="Nouveau chat" action="#{bb.nouveauChat}" />

            <!-- Les éléments de la page sont disposés en deux colonnes :
            question et réponse à gauche et historique de la conversation à droite. -->
            <h:panelGrid id="paneltotal" columns="2" columnClasses="topAligned,topAligned">

                <h:panelGrid id="panelgauche" columns="1">
                    <h:panelGrid id="questionetreponse" columns="1">
                        <h:panelGroup>
                            <h:outputText value="Question :" style="font-weight: 600; color: #333; font-size: 16px;"/>
                            <button onclick="copyToClipboard('question')" style="margin-left: 10px;">Copier question</button>
                            <button onclick="toutEffacer()">Effacer question et réponse</button>
                        </h:panelGroup>
                        <h:inputTextarea id="question" value="#{bb.question}" title="Question"
                                         cols="50" rows="5" styleClass="question-textarea"/>
                        <h:commandButton value="Envoyer la question" action="#{bb.envoyer}" styleClass="send-button"/>
                        <h:panelGroup>
                            <h:outputText value="Réponse :" style="font-weight: 600; color: #333; font-size: 16px;"/>
                            <button onclick="copyToClipboard('reponse')" style="margin-left: 10px;">Copier réponse</button>
                        </h:panelGroup>
                        <h:inputTextarea id="reponse" value="#{bb.reponse}" title="Réponse"
                                         cols="50" rows="15" styleClass="response-textarea"/>
                    </h:panelGrid>

                </h:panelGrid>
                <h:panelGrid id="paneldroit" columns="1" style="vertical-align: top;">
                    <h:panelGroup>
                        <h:outputText value="Conversation :" style="font-weight: 600; color: #333; font-size: 16px;"/>
                        <button onclick="copyToClipboard('conversation')" style="margin-left: 10px;">Copier conversation</button>
                    </h:panelGroup>
                    <h:inputTextarea id="conversation" rows="30" cols="50" readonly="true"
                                     value="#{bb.conversation}" title="Conversation entière" styleClass="conversation-textarea"/>
                </h:panelGrid>

            </h:panelGrid>
        </h:form>
    </f:view>
</h:body>
</html>

